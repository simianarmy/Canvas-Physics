<!DOCTYPE html>  <html> <head>   <title>particles.js.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="Array.js.html">                 Array.js.coffee               </a>                                           <a class="source" href="Canvas.js.html">                 Canvas.js.coffee               </a>                                           <a class="source" href="Circle.js.html">                 Circle.js.coffee               </a>                                           <a class="source" href="Line.js.html">                 Line.js.coffee               </a>                                           <a class="source" href="Math.js.html">                 Math.js.coffee               </a>                                           <a class="source" href="Polygon.js.html">                 Polygon.js.coffee               </a>                                           <a class="source" href="PoolTable.html">                 PoolTable.coffee               </a>                                           <a class="source" href="Rectangle.js.html">                 Rectangle.js.coffee               </a>                                           <a class="source" href="Shape.js.html">                 Shape.js.coffee               </a>                                           <a class="source" href="Spring.js.html">                 Spring.js.coffee               </a>                                           <a class="source" href="canvasEvents.js.html">                 canvasEvents.js.coffee               </a>                                           <a class="source" href="circles_scene.js.html">                 circles_scene.js.coffee               </a>                                           <a class="source" href="collisions.js.html">                 collisions.js.coffee               </a>                                           <a class="source" href="particles.js.html">                 particles.js.coffee               </a>                                           <a class="source" href="vec.js.html">                 vec.js.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               particles.js.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>General particle systems functions</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>= require ./vec</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">particles = </span><span class="p">(</span><span class="o">-&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Calculates properties of a movable particle attached to a fixed 
point on by a undamped, uncoupled spring.
@param {Spring} spring the spring object
@param {Particle} p the particle object
  which must have a speed, direction, and mass
@param {Number} te total energy or null (it will be calculated)
@param {Number} ts time step
@param {Number} g gravity
@return {Object} name/result of calculations for:
  pos {Vector} new particle position
  speed {Number} new particle speed
  velocity {Vector} new particle velocity
  totalEnergy {Number} new total energy</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">particleOnSpring = </span><span class="nf">(spring, particle, te, ts, g) -&gt;</span>
    <span class="nv">res = </span><span class="p">{}</span>
    <span class="nv">pspeed = </span><span class="nx">particle</span><span class="p">.</span><span class="nx">speed</span>
    <span class="nv">pmass = </span><span class="nx">particle</span><span class="p">.</span><span class="nx">mass</span>
    <span class="nv">v = </span><span class="nx">spring</span><span class="p">.</span><span class="nx">pnt1</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">spring</span><span class="p">.</span><span class="nx">pnt2</span><span class="p">)</span>
    <span class="nv">d = </span><span class="nx">v</span><span class="p">.</span><span class="nx">mag</span><span class="p">()</span>
    <span class="nv">e = </span><span class="nx">d</span> <span class="o">-</span> <span class="nx">spring</span><span class="p">.</span><span class="nx">length</span>
    </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>calculate energy if necessary</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">te</span> <span class="o">==</span> <span class="kc">null</span>
      <span class="nv">te = </span><span class="nx">pmass</span> <span class="o">*</span> <span class="nx">pspeed</span> <span class="o">*</span> <span class="nx">pspeed</span> <span class="err">/ 2</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>elastic p.e.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="nx">spring</span><span class="p">.</span><span class="nx">isCompressive</span><span class="p">()</span>
        <span class="nv">epe = </span><span class="nx">spring</span><span class="p">.</span><span class="nx">elasticity</span> <span class="o">*</span> <span class="nx">e</span> <span class="o">*</span> <span class="nx">e</span> <span class="err">/ 2</span>
        <span class="nx">te</span> <span class="o">+=</span> <span class="nx">epe</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>grav. p.e.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">g</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="nv">gpe = </span><span class="nx">pmass</span> <span class="o">*</span> <span class="nx">g</span> <span class="o">*</span> <span class="nx">spring</span><span class="p">.</span><span class="nx">pnt2</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="nx">te</span> <span class="o">-=</span> <span class="nx">gpe</span>
    </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>calculate force</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">f = </span><span class="nx">$V</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">pmass</span> <span class="o">*</span> <span class="nx">g</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="c1"># weight</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="nx">spring</span><span class="p">.</span><span class="nx">isCompressive</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">d</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>v/d gives direction of spring</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">f = </span><span class="nx">f</span><span class="p">.</span><span class="nx">add</span> <span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">spring</span><span class="p">.</span><span class="nx">elasticity</span> <span class="o">*</span> <span class="nx">e</span> <span class="err">/ d)</span>
        </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>calculate new position</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">a = </span><span class="nx">f</span><span class="p">.</span><span class="nx">divide</span><span class="p">(</span><span class="nx">pmass</span><span class="p">)</span>
    <span class="nv">disp = </span><span class="nx">particle</span><span class="p">.</span><span class="nx">direction</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">pspeed</span> <span class="o">*</span> <span class="nx">ts</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">ts</span> <span class="o">*</span> <span class="nx">ts</span> <span class="err">/ 2))</span>
    <span class="nv">pos = </span><span class="nx">spring</span><span class="p">.</span><span class="nx">pnt2</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">disp</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>calculate new elastic energy</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">newd = </span><span class="nx">pos</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">spring</span><span class="p">.</span><span class="nx">pnt1</span><span class="p">).</span><span class="nx">mag</span><span class="p">()</span>
    <span class="nv">newe = </span><span class="nx">newd</span> <span class="o">-</span> <span class="nx">spring</span><span class="p">.</span><span class="nx">length</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">newe</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="nx">spring</span><span class="p">.</span><span class="nx">isCompressive</span><span class="p">()</span>
      <span class="nv">epe = </span><span class="nx">spring</span><span class="p">.</span><span class="nx">elasticity</span> <span class="o">*</span> <span class="nx">newe</span> <span class="o">*</span> <span class="nx">newe</span> <span class="err">/ 2</span>
    <span class="k">else</span>
      <span class="nv">epe = </span><span class="mi">0</span>
    </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>calculate new kinetic energy and hence speed</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">ke = </span><span class="nx">te</span> <span class="o">-</span> <span class="nx">epe</span> <span class="o">+</span> <span class="nx">pmass</span> <span class="o">*</span> <span class="nx">g</span> <span class="o">*</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">ke</span> <span class="o">&lt;=</span> <span class="mi">0</span>
      <span class="nv">speed = </span><span class="mi">0</span>
    <span class="k">else</span>
      <span class="nv">speed = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">ke</span> <span class="err">/ pmass)</span>
      <span class="nv">velocity = </span><span class="nx">disp</span><span class="p">.</span><span class="nx">toUnitVector</span><span class="p">()</span>
    
    <span class="p">{</span><span class="nv">pos: </span><span class="nx">pos</span>
    <span class="nv">speed: </span><span class="nx">speed</span>
    <span class="nv">velocity: </span><span class="nx">velocity</span>
    <span class="nv">totalEnergy: </span><span class="nx">te</span><span class="p">}</span>
    
  <span class="p">{</span><span class="nx">particleOnSpring</span><span class="p">}</span>
<span class="p">)()</span>

<span class="nv">root = </span><span class="nx">exports</span> <span class="o">?</span> <span class="nb">window</span>
<span class="nv">root.particles = </span><span class="nx">particles</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 